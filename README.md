# Overview
This tool was written by the WPP for use by WECC members to run Transient Stability analysis more easily in PowerWorld Simulator.

## WECC Criteria Monitors
The WECC Criteria for Transient Stability simulations is documented in [TPL-001-WECC-CRT-3.2](https://www.wecc.org/Reliability/TPL-001-WECC-CRT-3.2.pdf). A brief summary of the WECC "Finger Diagram" (slang) transient stability violations is provided below:
  - WR1.3: V < 80% x V<sub>init</sub> (After t = 20s)
  - WR1.4: V < 80% x V<sub>init</sub> (Lasting > 2s)
  - WR1.5: V < 70% x V<sub>init</sub> (Lasting > 0.5s)

The WECC Criteria are included in the monitor settings, as generated by PowerWorld's functionality under:
  - `Add Ons` &rarr; `Transient Stability` &rarr; `Transient Limit Monitors` &rarr; Right Click &rarr; `Transient Limit Monitor Records` -> `Build WECC 2016 Monitors`

## Additional Monitor Notes
Additional monitors have been included for convenience. There are multiple locations were these monitors are defined in PowerWorld, including: 
  - `Options` &rarr; `Generic Limit Monitors`
  - Transient Limit Monitors
  - Result Analyzer - Damping
    - For these monitors, please note that you MUST save any channels to disk which you wish to analyze using the damping analyzer.
      - Please refer to: `Result Storage` &rarr; `Save to Hard Drive Options`
    - For damping analysis, please note that inter-area oscillation modes can be quite low frequency, down to 0.16 Hz. [NERC Interconnection Oscillation Analysis](https://www.nerc.com/comm/PC/SMSResourcesDocuments/Interconnection_Oscillation_Analysis.pdf)
    - 3% Damping Monitor
      - This criteria is from [CAISO Procedure 3100](https://www.caiso.com/documents/3100.pdf), which indicates:
      - > The system is considered to demonstrate acceptable positive damping if the damping ratio of the power system oscillations is 3% or greater. The signals used generally include power angle, voltage and/or frequency.

# How to Run
To run the tool:
  - Save PWB models in the project folder, with Stability data already loaded in the PWB files.
  - Correct your dynamics errors
    - `Transient Stability` &rarr; `Validation` &rarr; `Validation Errors` &rarr; `Run Validation & Run AutoCorrection`
    - Note that any uncorrected errors will be saved to `Output_CSV_TSValidation`, and auto-corrected upon run.
  - Run `_Clear_Results-Init_Folders.bat` to clear out any old results.
  - Adjust these files to fit the settings you would like for the simulations: 
    - `__RunTS.aux`
    - `Settings_TS.aux`
    - `Settings_TS_Contingencies.aux`
    - `Settings_TS_Limit_Monitors.aux`
    - `Settings_TS_Plots.aux`
  - Open the PWB files you wish to run. 
    - `_Open_All_Cases.bat` is available if you want to automatically open all PWB files in the local directory. 
    - `_Kill_PowerWorld.bat` is available in case you encounter issues that require killing all running instances of PowerWorld Simulator. 
  - From PowerWorld's GUI, run `__RunTS.aux` for each case.
    - This will run the simulations, and save out the results into the `Output_` folders. 
  - After running, you may open `_Results.xlsx` to view the results. 
    - You must refresh the queries via:
      - `Data` &rarr; `Refresh All`
    - To edit queries, you may go to: 
      - `Data` &rarr; `Queries & Connections` &rarr; Right Click on the query you wish to modify &rarr; `Edit`
    - Note that the `TSResultEvent` table does not get directly loaded into an Excel table, but rather into the Excel Data Model. This is because in practice, this table may contain many millions of results. Excel has a limited number of rows, ending at 1,048,576. To view the Data Model within Excel, 

# Installation of PowerPivot
If you wish to view or modify the Data Model, please install PowerPivot in Excel. To do so:
  - `File` &rarr; `Options` &rarr; `Add-ins` &rarr; Manage `Com Add-ins` &rarr; `Go` &rarr; Check `Microsoft Power Pivot for Excel` &rarr; `OK`
  - Now you will have a tab for Power Pivot on your Ribbon.
  - To view the data models, you may go to `Power Pivot` &rarr; Data Model `Manage` &rarr; `Home` Tab &rarr; `View` &rarr; `Data View`

# Note: Sample Cases
The sample simulations were generated using PowerWorld's provided `TS9Bus Load Drop.pwb` case, from [TrainingCases.zip](https://www.powerworld.com/files/TrainingCases.zip)

# Note: GDI Object Limits
The GDI Object Limit was encountered by the WPP when trying to do N-0 tests on a large number of various PowerWorld models at the same time (for data-checking purposes). At the time of writing, this issue was encountered when loading more than 9 instances of PowerWorld's transient stability tool. 

Windows operating system has a limit of 65,536 GDI objects loaded in memory across all applications currently running. See [Microsoft - GDI Handles](https://www.winccoa.com/documentation/WinCCOA/3.18/en_US/Native_GEDI/Referenz_Native_GEDI-65.html).

To ensure one process does not take all the resources and cause Windows to crash, the per-process limit is 10,000 by default. This is a limit of 10,000 GDI objects across all instances of `pwrworld.exe`. 

The PowerWorld Transient Stability window loads a significant number of GDI objects in memory at once. If you are running multiple copies of PowerWorld simulator, and each has the Transient Stability window open, you may run out of GDI objects for `pwrworld.exe`, causing the software to break. As of writing (April 2024), this appears to be a limit of 9 instances of PowerWorld in memory (stable), where running the 10th instance will cause instability in each instance of PowerWorld, which is only resolved by closing all open copies of PowerWorld Simulator. 

To work around this issue, you can run Transient Stability simulations via an AUX file (without opening the Transient Stability window), or you can increase the GDI limit per process (at your own risk). 

You may edit this value under regedit, at the following key:

> HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\GDIProcessHandleQuota
>
> GDIProcessHandleQuota



